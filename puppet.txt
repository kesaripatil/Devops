Terminologies
puppet, puppetserver, puppet-agent, puppetdb, hiera, facter, catalog, manifest, module

--

1. puppet is server config mgmt and automation tool.
2. puppet package -> [puppetserver, puppet-agent, puppetdb] - hiera & facter
3. works in agent-server architecture
4. puppet server and agent communicates over HTTPS using SSL certs.
5. facter collects data about agents like os, ip address, hostname.
6. puppet agent send these facts to server in a special puppet code file called manifest.
7. catalog - json file which is compiled by server and sent to agent describing the desired state of agent.
8. module manages the specific task. It contains both code & data.
9. hiera is a tool which separate the data and code and place it in a centralized location.
10. puppetdb stores all the data generated by puppet i.e catalog, reports, facts.
11. describe the desired state of your system in files called manifests

---

Resources
	resource_type {'name':
		attribute => value
	}

Ex - service {'ssh':
	ensure => running,
     }

Available resource types
1. Cron
2. File
3. Service
4. Package
5. Group
6. Exec
7. Notify
8. User
<note>we can write custom resource too

Multiple resources can be combined into classes.

Ex - 

class openssh {
	package {'openssh-server':
	  ensure => installed,
	}
	
	file { 'etc/ssh/sshd_config':
	  ensure => file,
	  owner => 'root',
	  mode => '0600'
	}
	
	service { 'ssh':
	  ensure = running,
	}
}

Manifests - Resources & Classes are written in manifest file.
extension -> .pp

Modules - Is dir tree
contains manifest and other files, packages arranged in away system can understand.

catalog - Puppet server compiles the desired state into catalog. Nodes requests catalog from server.

---
puppetserver.example.com

---
###########################################
# Init settings for puppetserver
###########################################

# Location of your Java binary (version 7 or higher)
JAVA_BIN="/usr/bin/java"

# Modify this if you'd like to change the memory allocation, enable JMX, etc
JAVA_ARGS="-Xms2g -Xmx2g -XX:MaxPermSize=256m"

# These normally shouldn't need to be edited if using OS packages
USER="puppet"
GROUP="puppet"
INSTALL_DIR="/opt/puppetlabs/server/apps/puppetserver"
CONFIG="/etc/puppetlabs/puppetserver/conf.d"

BOOTSTRAP_CONFIG="/etc/puppetlabs/puppetserver/services.d/,/opt/puppetlabs/server/apps/puppetserver/config/services.d/"

SERVICE_STOP_RETRIES=60

START_TIMEOUT=300

RELOAD_TIMEOUT=120

Generate certificate

puppetserver ca generate --certname <CERTNAME> --subject-alt-names <DNS ALT NAMES> --ca-client
puppetserver ca generate --certname puppetserver --subject-alt-names puppetserver --ca-client

puppetserver ca clean --certname puppetclient --config /etc/puppetlabs/puppet/puppet.conf

puppetserver ca list --all --config /etc/puppetlabs/puppet/puppet.conf

#Prints all the config values used by puppet
puppet config print 

Find out the FQDN of your puppetmaster by issuing:

# openssl x509 -noout -subject -in /var/lib/puppet/ssl/ca/ca_crt.pem
subject= /CN=Puppet CA: host.domain.com

root@my-ec2:~# openssl x509 -noout -subject -in /etc/puppetlabs/puppet/ssl/ca/ca_crt.pem 
subject=CN = Puppet CA: puppetclient

Last login: Sun Aug 29 06:07:00 2021 from 157.33.1.235
ubuntu@my-ec2:~$ cat /etc/puppetlabs/puppet/puppet.conf 
# This file can be used to override the default puppet settings.
# See the following links for more details on what settings are available:
# - https://puppet.com/docs/puppet/latest/config_important_settings.html
# - https://puppet.com/docs/puppet/latest/config_about_settings.html
# - https://puppet.com/docs/puppet/latest/config_file_main.html
# - https://puppet.com/docs/puppet/latest/configuration.html
[server]
vardir = /opt/puppetlabs/server/data/puppetserver
logdir = /var/log/puppetlabs/puppetserver
rundir = /var/run/puppetlabs/puppetserver
pidfile = /var/run/puppetlabs/puppetserver/puppetserver.pid
codedir = /etc/puppetlabs/code
certname = puppetserver

[main]
certname = puppetclient
server = puppetserver

[agent]
server = puppetserver


